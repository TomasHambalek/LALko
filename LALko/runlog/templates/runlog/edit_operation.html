{% extends "runlog/base.html" %}

{% block content %}
<h2>{{ form.instance.pk|yesno:"Edit,Add new" }} operation</h2>
<form method="post">
    {% csrf_token %}

    {% for field in form %}
        {% if field.name == 'start_time' or field.name == 'end_time' %}
            <p>
                {{ field.label_tag }}
                {{ field }}
                <button type="button" onclick="setNow('{{ field.id_for_label }}')">Now</button>
            </p>
        {% else %}
            <p>{{ field.label_tag }} {{ field }}</p>
        {% endif %}
    {% endfor %}

    <script>
    function setNow(fieldId) {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        
        const formattedTime = `${year}-${month}-${day} ${hours}:${minutes}`;

        document.getElementById(fieldId).value = formattedTime;
    }
    </script>
    
    <button type="submit">Save</button>
</form>
{% endblock %}